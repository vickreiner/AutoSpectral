<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aurora_example • AutoSpectral</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Aurora_example">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AutoSpectral</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.8.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Aurora_example.html">Aurora_example</a>
    </li>
    <li>
      <a href="../articles/Cleaning.html">Cleaning</a>
    </li>
    <li>
      <a href="../articles/Control_File_example.html">Control_File_example</a>
    </li>
    <li>
      <a href="../articles/Development.html">Development</a>
    </li>
    <li>
      <a href="../articles/Full_AutoSpectral_Workflow.html">Full Workflow Example</a>
    </li>
    <li>
      <a href="../articles/Gating.html">Gating</a>
    </li>
    <li>
      <a href="../articles/Per_Cell_Optimization.html">Per Cell Optimization</a>
    </li>
    <li>
      <a href="../articles/Plotting.html">Plotting</a>
    </li>
    <li>
      <a href="../articles/Reload_AutoSpectral.html">Re-running_AutoSpectral</a>
    </li>
    <li>
      <a href="../articles/Single_Cell_AutoFluorescence.html">Single Cell Autofluorescence</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DrCytometer/AutoSpectral/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Aurora_example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DrCytometer/AutoSpectral/blob/HEAD/vignettes/articles/Aurora_example.Rmd" class="external-link"><code>vignettes/articles/Aurora_example.Rmd</code></a></small>
      <div class="hidden name"><code>Aurora_example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DrCytometer/AutoSpectral" class="external-link">AutoSpectral</a></span><span class="op">)</span></span></code></pre></div>
<p>To start, we need to get the relevant parameters for the cytometer.
This tells AutoSpectral a lot about what you’re doing. In this example,
we’ll use data from the Cytek Aurora.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">asp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.autospectral.param.html">get.autospectral.param</a></span><span class="op">(</span>cytometer <span class="op">=</span> <span class="st">"aurora"</span>, figures <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Create a folder containing only the single-stained control FCS files
describe the path to that folder here.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control.dir</span> <span class="op">&lt;-</span> <span class="st">"~/AutoSpectral_data/Aurora_example/Aurora_controls"</span></span></code></pre></div>
<p>With this information, we can create a draft of the control file.
More detail on this will be included in a separate article.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create.control.file.html">create.control.file</a></span><span class="op">(</span><span class="va">control.dir</span>, <span class="va">asp</span><span class="op">)</span></span></code></pre></div>
<p>For now, we’ll use the pre-filled control file, which you can get
from Mendeley Data at <a href="https://data.mendeley.com/datasets/xzt3h3gnx9/1" class="external-link uri">https://data.mendeley.com/datasets/xzt3h3gnx9/1</a></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">control.file</span> <span class="op">&lt;-</span> <span class="st">"~/AutoSpectral_data/Aurora_example/aurora_fcs_control_file.csv"</span></span></code></pre></div>
<p>Now we are ready to read in the fcs files, gate the cells and
organize the experiment.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flow.control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define.flow.control.html">define.flow.control</a></span><span class="op">(</span><span class="va">control.dir</span>, <span class="va">control.file</span>, <span class="va">asp</span><span class="op">)</span></span></code></pre></div>
<p>Check the gating plots.</p>
<p>CD8 T cell gating: <img src="figures/SparkUV387.jpg" alt="CD8 lymphocyte gating plot"></p>
<p>CD14 monocyte gating: <img src="figures/BV510.jpg" alt="CD14 monocyte gating plot"></p>
<p>There are several parameters that control the automated gating. This
will be covered in a separate article.</p>
<p>Control cleaning is always recommended. The default option
downsamples and sets universal negatives, provided these are specified
in the control file. More detail on this in a separate article.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flow.control</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean.controls.html">clean.controls</a></span><span class="op">(</span><span class="va">flow.control</span>, <span class="va">asp</span><span class="op">)</span></span></code></pre></div>
<p>This generates scatter-matching plots showing the FSC/SSC of the
positive events and events from the universal negative in the same
region.</p>
<p>CD8 scatter-matching plot: <img src="figures/SparkUV387_scatter_plot.jpg" alt="CD8 scatter match plot"></p>
<p>CD14 scatter-matching plot: <img src="figures/BV510_scatter_plot.jpg" alt="CD14 scatter match plot"></p>
<p>Spectra can now be isolated from the controls. To use the cleaned
data, set <code>use.clean.expr</code> to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spectra</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.fluorophore.spectra.html">get.fluorophore.spectra</a></span><span class="op">(</span><span class="va">flow.control</span>, <span class="va">asp</span>, use.clean.expr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Check the spectral traces and heatmaps–do they look right?</p>
<p>Normalized fluorophore signatures: <img src="figures/UniversalNegativeSpectra.jpg" alt="Spectral Trace">
Spectral heatmap: <img src="figures/Viridis_spectral_heatmap.jpg" alt="Spectral heatmap"></p>
<p>Now we can unmix. In this example we’re just going to cover basic
unmixing using ordinary least squares, which is what you’ll get in
SpectroFlo on the Aurora. By default, AutoSpectral extracts a single AF
parameter, much like selecting the “spectral unmixing with
autofluorescence extraction” option. To unmix without AF extraction,
remove this from the spectral matrix:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fluorophore.only.spectra</span> <span class="op">&lt;-</span> <span class="va">spectra</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">spectra</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"AF"</span>, <span class="op">]</span></span></code></pre></div>
<p>We can unmix a single FCS file:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/unmix.fcs.html">unmix.fcs</a></span><span class="op">(</span><span class="st">"~/AutoSpectral_data/Aurora_example/Aurora_fully_stained/E1 Fresh_100ul_TS_BS_005.fcs"</span>,</span>
<span>          <span class="va">spectra</span>, <span class="va">asp</span>, <span class="va">flow.control</span>, method <span class="op">=</span> <span class="st">"OLS"</span><span class="op">)</span></span></code></pre></div>
<p>Or, if we have a bunch of files in the folder, we can unmix them
all:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/unmix.folder.html">unmix.folder</a></span><span class="op">(</span><span class="st">"~/AutoSpectral_data/Aurora_example/AutoSpectral/Aurora_fully_stained/"</span>,</span>
<span>             <span class="va">spectra</span>, <span class="va">asp</span>, <span class="va">flow.control</span>, method <span class="op">=</span> <span class="st">"OLS"</span><span class="op">)</span></span></code></pre></div>
<p>By default, parallel processing is off. To activate it for faster
unmixing, set:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">asp</span><span class="op">$</span><span class="va">parallel</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>Do this before calling the function, e.g.,
<code>define.flow.control</code> or <code>clean.controls.</code> Turn it
off again at any point:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">asp</span><span class="op">$</span><span class="va">parallel</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Oliver Burton, Adrian Liston.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
